{% extends "inventario/base.html" %}
{% block content %}

<div class="row" style="justify-content:space-between;margin-bottom:12px">
  <div>
    <div style="font-size:22px;font-weight:800">Dashboard</div>
    <div class="muted">Toners + movimientos recientes</div>
  </div>

  <form method="get" class="row">
    <input
      name="q"
      value="{{ q }}"
      placeholder="Buscar toner (marca / modelo / código)"
      style="width:320px"
    >
    <button class="btn" type="submit">Buscar</button>
  </form>
</div>

<div class="grid">
  <!-- ================= TONERS ================= -->
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0">Toners</h3>
      <a class="btn" href="/toners/nuevo/">+ Nuevo</a>
    </div>

    <table>
      <thead>
        <tr>
          <th>Marca</th>
          <th>Modelo</th>
          <th>Código</th>
          <th>Stock</th>
        </tr>
      </thead>

      <tbody>
        {% for t in toners %}
          <tr
            onclick="window.location='/movimientos/nuevo/?toner={{ t.id }}'"
            style="cursor:pointer"
            title="Registrar movimiento"
          >
            <td>{{ t.marca }}</td>
            <td>{{ t.modelo }}</td>
            <td>{{ t.codigo|default:"-" }}</td>
            <td><strong>{{ t.stock }}</strong></td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="4" class="muted">No hay toners.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ================= MOVIMIENTOS RECIENTES ================= -->
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0">Movimientos recientes</h3>
      <a class="btn" href="/movimientos/nuevo/">+ Nuevo</a>
    </div>

    <table>
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Tipo</th>
          <th>Toner</th>
          <th>Cant</th>
          <th>Servicio</th>
        </tr>
      </thead>

      <tbody>
        {% for m in movimientos %}
          <tr>
            <td>{{ m.fecha|date:"Y-m-d H:i" }}</td>
            <td>{{ m.tipo }}</td>
            <td>{{ m.toner.marca }} {{ m.toner.modelo }}</td>
            <td><strong>{{ m.cantidad }}</strong></td>
            <td>{{ m.servicio.nombre|default:"-" }}</td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="5" class="muted">Sin movimientos.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- ================= STOCK BAJO ================= -->
<div class="card" style="margin-top:14px">
  <h3 style="margin-top:0">Stock bajo</h3>

  <table>
    <thead>
      <tr>
        <th>Toner</th>
        <th>Stock</th>
        <th>Mínimo</th>
      </tr>
    </thead>

    <tbody>
      {% for t in stock_bajo %}
        <tr>
          <td>{{ t.marca }} {{ t.modelo }}</td>
          <td><strong>{{ t.stock }}</strong></td>
          <td>{{ t.minimo }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="3" class="muted">Todo OK.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
